trigger:
  batch: true
  branches:
    include:
      - main

variables:
- name: registry
  value: 'nexus.ad.redshiftent.com'
- name: pool
  value: 'Redshift-AzureVMSS-x64'

stages:
- stage: Build_Omni_Infra_Provider
  displayName: 'Build Omni Infra Provider - vSphere'
  jobs:
  - job: build
    displayName: 'Build Omni Infra Provider'
    pool:
      name: $(pool)
    steps:
    - task: Docker@2
      displayName: 'Docker Login'
      inputs:
        command: 'login'
        containerRegistry: 'Nexus-DockerRegistry'
    - script: |
        make image-omni-infra-provider-vsphere REGISTRY=$(registry) USERNAME=redshift PUSH=true
      displayName: 'Build and Push Container Image'